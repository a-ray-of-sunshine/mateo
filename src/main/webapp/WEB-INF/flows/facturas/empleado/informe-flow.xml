<?xml version="1.0" encoding="UTF-8"?>

<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">
    <var name="informeEmpleado" class="mx.edu.um.mateo.contabilidad.facturas.model.InformeEmpleado"/>    
    <var name="informeEmpleadoDetalle" class="mx.edu.um.mateo.contabilidad.facturas.model.InformeEmpleadoDetalle"/>    
    <var name="flowScope.proveedor" class="mx.edu.um.mateo.general.model.Proveedor"/>
    <!--  <var name="informeEmpleadoManagerImpl" class="mx.edu.um.mateo.contabilidad.facturas.service.impl.InformeEmpleadoManagerImpl"/>  
    -->
    
    
    
    <view-state id="listaInformes" view="/WEB-INF/jsp/factura/informe/lista.jsp">
        <on-render>
            <evaluate expression="informeEmpleadoManager.getInformes(externalContext.sessionMap.empresaId)" result="requestScope.informes"/>
        </on-render>
        <transition on="crearInforme" to="nuevoInforme"/>
            
    </view-state>
    
    <view-state id="nuevoInforme" view="/WEB-INF/jsp/factura/informe/nuevo.jsp" model="informeEmpleado">
        <transition on="grabaInforme" to="nuevoInformeDetalle">
            <evaluate expression="informeEmpleadoAction.creaInforme" />
        </transition>
    </view-state>
    
    <view-state id="nuevoInformeDetalle" view="/WEB-INF/jsp/factura/detalle/nuevo.jsp" model="informeEmpleadoDetalle">
        <transition on="grabaEncabezado" to="endState" >
            <evaluate expression="informeEmpleadoAction.processFile"/>
        </transition>
        <transition on="cancel" to="finish" bind="false"/>
    </view-state>
    
    <!--
    <view-state id="nuevoInformeDetalle" view="/WEB-INF/jsp/factura/detalle/nuevo.jsp" model="informeEmpleadoDetalle">
        <transition on="grabaEncabezado" to="endState">
            <evaluate expression="informeEmpleadoAction.creaInformeDetalle" />
        </transition>
    </view-state>
    -->
    <end-state id="endState" commit="true" view="externalRedirect:contextRelative:/factura/informe" />

    <global-transitions>
        <transition on="cancel" to="endState" />
    </global-transitions>
</flow>